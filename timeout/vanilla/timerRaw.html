<!DOCTYPE html>
<html lang="en">
<body id="home">
	<h1>Raw timer tests</h1>
    <script>
        var DELAY = 100;
        var ITTERATIONS = 50;
        var now = performance.now ? performance.now.bind(performance) : function(){return +new Date()}

        function time(callback){
            var start = now();
            setTimeout(function(){
                callback(now() - start);
            }, DELAY);
        }


        function run(log, callback){
            if (log.length < ITTERATIONS) time(function(value){
                log.push(value - DELAY);
                if (log.length % 10 === 0) console.log(log.length);
                run(log, callback);
            });
            else callback && callback(log);
        }

        function average(arr){
            return arr.reduce(function(sum, value){return sum + value}, 0) / (arr.length || 1);
        }

        function sd(arr){
            var avg = average(arr);
            return Math.sqrt(arr.reduce(function(sum, value){ return sum + Math.pow(value-avg,2)}, 0) / (arr.length || 1));
        }

        function noise(){
            for (var i=0; i<100000; i++) Math.floor(Math.sqrt(Math.random()));
            if (window.NOISE_ON) setTimeout(noise, 0);
        }

        window.NOISE_ON = true;
        noise();
        run([], function(log){
            window.NOISE_ON = false;
            console.log('avg: ', average(log));
            console.log('sd: ', sd(log));
            console.log('min/max: ', Math.min.apply(Math, log), Math.max.apply(Math, log));
        });

    </script>
</body>
</html>
